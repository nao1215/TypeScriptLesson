/**
 * Lesson 64: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† (Package Management) - æ¼”ç¿’å•é¡Œ
 */

// =============================================================================
// æ¼”ç¿’1: ä¾å­˜é–¢ä¿‚åˆ†æ
// =============================================================================

/**
 * æ¼”ç¿’1: ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã‚’åˆ†æã—ã€å•é¡Œã‚’ç‰¹å®šã—ã¦ãã ã•ã„
 */
const packageDependencies = {
  "lodash": "^4.17.21",
  "moment": "^2.29.4", // ğŸ› å•é¡Œ: momentã¯éæ¨å¥¨ã€ä»£æ›¿æ¡ˆã¯ï¼Ÿ
  "jquery": "^3.6.0",  // ğŸ› å•é¡Œ: jQueryã¯ç¾ä»£çš„ãªé–‹ç™ºã§ã¯å¿…è¦ï¼Ÿ
  "left-pad": "^1.3.0" // ğŸ› å•é¡Œ: å°ã•ã™ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
};

// TODO: ä¸Šè¨˜ã®ä¾å­˜é–¢ä¿‚ã®å•é¡Œç‚¹ã‚’ç‰¹å®šã—ã€æ”¹å–„æ¡ˆã‚’ææ¡ˆã—ã¦ãã ã•ã„
export function analyzeDependencies(deps: Record<string, string>): string[] {
  const issues: string[] = [];
  
  // ã“ã“ã«åˆ†æãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
  
  return issues;
}

// =============================================================================
// æ¼”ç¿’2: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ¤œå‡º
// =============================================================================

/**
 * æ¼”ç¿’2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’æ¤œå‡ºã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
 */
export function detectPackageManager(projectPath: string): 'npm' | 'yarn' | 'pnpm' | 'unknown' {
  // TODO: ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦é©åˆ‡ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’è¿”ã—ã¦ãã ã•ã„
  // - pnpm-lock.yaml â†’ 'pnpm'
  // - yarn.lock â†’ 'yarn'  
  // - package-lock.json â†’ 'npm'
  // - ã©ã‚Œã‚‚ãªã„å ´åˆ â†’ 'unknown'
  
  return 'unknown';
}

// =============================================================================
// æ¼”ç¿’3: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒ
// =============================================================================

/**
 * æ¼”ç¿’3: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ¯”è¼ƒé–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
 */
export function compareVersions(version1: string, version2: string): -1 | 0 | 1 {
  // TODO: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¯”è¼ƒã—ã¦çµæœã‚’è¿”ã—ã¦ãã ã•ã„
  // version1 < version2 ãªã‚‰ -1
  // version1 = version2 ãªã‚‰ 0  
  // version1 > version2 ãªã‚‰ 1
  
  return 0;
}

// =============================================================================
// æ¼”ç¿’4: è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
// =============================================================================

interface VulnerabilityReport {
  package: string;
  version: string;
  severity: 'low' | 'moderate' | 'high' | 'critical';
  description: string;
}

/**
 * æ¼”ç¿’4: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
 */
export async function checkVulnerabilities(packageName: string, version: string): Promise<VulnerabilityReport[]> {
  // TODO: å®Ÿéš›ã®è„†å¼±æ€§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å®Ÿè£…
  // ï¼ˆã“ã®æ¼”ç¿’ã§ã¯ã€æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰
  
  const mockVulnerabilities: VulnerabilityReport[] = [
    {
      package: 'lodash',
      version: '4.17.20',
      severity: 'high',
      description: 'Prototype Pollution'
    }
  ];
  
  // ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åŸºã¥ã„ã¦é–¢é€£ã™ã‚‹è„†å¼±æ€§ã‚’è¿”ã—ã¦ãã ã•ã„
  return [];
}

// =============================================================================
// æ¼”ç¿’5: ä¾å­˜é–¢ä¿‚ãƒ„ãƒªãƒ¼æ§‹ç¯‰
// =============================================================================

interface DependencyNode {
  name: string;
  version: string;
  dependencies: DependencyNode[];
}

/**
 * æ¼”ç¿’5: ä¾å­˜é–¢ä¿‚ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
 */
export function buildDependencyTree(packageJson: any, lockfile: any): DependencyNode {
  // TODO: package.jsonã¨ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜é–¢ä¿‚ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„
  
  return {
    name: packageJson.name || 'unknown',
    version: packageJson.version || '0.0.0',
    dependencies: []
  };
}